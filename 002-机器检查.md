### 允许iptables检查桥接流量

1.  `lsmod | grep br_netfilter` 如果没有输出则是没有开启

2. 手动开启允许检查桥接流量 ` sudo modeprobe br_netfilter`

3. 检查`sysctl` 中相关的配置项 `net.brige.brige-nf-call-iptables` 是否为1

   > cat /ect/modules-load.d/k8s.conf       

 4. 如果步骤3的输出不正常则 添加该配置

    > cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
    > br_netfilter
    > EOF
    >
    > cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
    > net.bridge.bridge-nf-call-ip6tables = 1
    > net.bridge.bridge-nf-call-iptables = 1
    > EOF
    > sudo sysctl --system

5. 检查端口是否通畅 `6443` `命令:telnet 127.0.0.1 6443`

6. 添加kubernates yum数据源 `原文档中gpgcheck repo_gpgcheck 为1 yum update 会报错`

   > ```bash
   > cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
   > [kubernetes]
   > name=Kubernetes
   > baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
   > enabled=1
   > gpgcheck=0
   > repo_gpgcheck=0
   > gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
   > exclude=kubelet kubeadm kubectl
   > EOF
   > ```

7.  将 SELinux 设置为 permissive 模式（相当于将其禁用）

   > ```bash
   >  sudo setenforce 0
   > sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config
   > ```

8. 安装 相关工具 `sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes`

9. 自启动 `sudo systemctl enable --now kubelet`

